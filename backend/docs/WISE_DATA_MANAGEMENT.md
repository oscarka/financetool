# Wiseæ•°æ®ç®¡ç†æ¶æ„

## ğŸ“‹ æ¦‚è¿°

Wiseæ•°æ®ç®¡ç†æ¨¡å—ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ä¸Wiseæ±‡ç‡ç›¸å…³çš„æ•°æ®åº“ç»´æŠ¤ã€æ£€æŸ¥å’Œè¯Šæ–­åŠŸèƒ½ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¨¡å—
- **`app/utils/wise_data_manager.py`** - ç»Ÿä¸€çš„æ•°æ®ç®¡ç†ç±»
- **`check_wise_data.py`** - å‘½ä»¤è¡Œæ£€æŸ¥å·¥å…·
- **`run.py`** - å¯åŠ¨æ—¶å¯é€‰ç»´æŠ¤åŠŸèƒ½

### åŠŸèƒ½æ•´åˆ
- âœ… åºåˆ—ä¿®å¤
- âœ… é‡å¤è®°å½•æ¸…ç†
- âœ… æ•°æ®çŠ¶æ€æ£€æŸ¥
- âœ… é—®é¢˜è¯Šæ–­
- âœ… ç»´æŠ¤ä»»åŠ¡

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å‘½ä»¤è¡Œæ£€æŸ¥
```bash
# æ£€æŸ¥æ•°æ®çŠ¶æ€
python check_wise_data.py

# ä½¿ç”¨ç®¡ç†æ¨¡å—
python -m app.utils.wise_data_manager --action check
python -m app.utils.wise_data_manager --action maintenance
python -m app.utils.wise_data_manager --action fix-sequence
python -m app.utils.wise_data_manager --action clean-duplicates
```

### 2. å¯åŠ¨æ—¶ç»´æŠ¤
```bash
# å¯ç”¨å¯åŠ¨æ—¶ç»´æŠ¤
RUN_WISE_MAINTENANCE=true python run.py
```

### 3. ç¼–ç¨‹æ¥å£
```python
from app.utils.wise_data_manager import WiseDataManager

# åˆ›å»ºç®¡ç†å™¨
manager = WiseDataManager()

# è¿è¡Œç»´æŠ¤
result = manager.run_maintenance()

# æ£€æŸ¥çŠ¶æ€
status = manager.check_data_status()

# è·å–æ‘˜è¦
summary = manager.get_data_summary()
```

## ğŸ”§ åŠŸèƒ½è¯´æ˜

### åºåˆ—ä¿®å¤
- ä¿®å¤PostgreSQLè‡ªå¢åºåˆ—ä¸è¡¨ä¸­æœ€å¤§IDä¸åŒ¹é…çš„é—®é¢˜
- é€‚ç”¨äºæ•°æ®è¿ç§»ã€æ‰‹åŠ¨æ’å…¥ç­‰åœºæ™¯

### é‡å¤è®°å½•æ¸…ç†
- æ£€æŸ¥å¹¶æ¸…ç†ç›¸åŒå¸ç§å¯¹å’Œæ—¶é—´çš„é‡å¤è®°å½•
- ä¿ç•™IDæœ€å°çš„è®°å½•ï¼Œåˆ é™¤å…¶ä»–é‡å¤

### æ•°æ®çŠ¶æ€æ£€æŸ¥
- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
- ç»Ÿè®¡è®°å½•æ•°å’Œå¸ç§å¯¹åˆ†å¸ƒ
- åˆ†ææ—¶é—´èŒƒå›´å’Œæ•°æ®æ–°é²œåº¦
- è‡ªåŠ¨è¯Šæ–­é—®é¢˜å¹¶æä¾›å»ºè®®

### ç»´æŠ¤ä»»åŠ¡
- ç»Ÿä¸€æ‰§è¡Œæ‰€æœ‰ç»´æŠ¤æ“ä½œ
- æä¾›è¯¦ç»†çš„æ‰§è¡Œç»“æœæŠ¥å‘Š

## ğŸ“Š æ£€æŸ¥å†…å®¹

### åŸºç¡€æ£€æŸ¥
- âœ… è¡¨ç»“æ„å­˜åœ¨æ€§
- ğŸ“Š æ€»è®°å½•æ•°ç»Ÿè®¡
- ğŸ¦ å¸ç§å¯¹åˆ†å¸ƒåˆ†æ

### æ—¶é—´åˆ†æ
- â° æ•°æ®æ—¶é—´èŒƒå›´
- ğŸ“… æœ€è¿‘7å¤©æ•°æ®é‡
- ğŸ” å„å¸ç§å¯¹æœ€æ–°è®°å½•

### é—®é¢˜è¯Šæ–­
- âŒ æ•°æ®ç¼ºå¤±é—®é¢˜
- âš ï¸ æ•°æ®ä¸å®Œæ•´é—®é¢˜
- ğŸ”§ è‡ªåŠ¨é—®é¢˜è¯†åˆ«
- ğŸ’¡ ä¿®å¤å»ºè®®

## ğŸ› ï¸ ç¯å¢ƒé…ç½®

### å¿…éœ€ç¯å¢ƒå˜é‡
```bash
DATABASE_URL=postgresql://user:pass@host:port/db
```

### å¯é€‰ç¯å¢ƒå˜é‡
```bash
# å¯ç”¨å¯åŠ¨æ—¶ç»´æŠ¤
RUN_WISE_MAINTENANCE=true

# è‡ªå®šä¹‰æ•°æ®åº“URL
DATABASE_URL=postgresql://custom_url
```

## ğŸ“ˆ ç›‘æ§é›†æˆ

### å¥åº·æ£€æŸ¥
```bash
# è¿”å›çŠ¶æ€ç 
python check_wise_data.py
echo $?  # 0=æ­£å¸¸, 1=å¼‚å¸¸
```

### æ—¥å¿—è¾“å‡º
- ä½¿ç”¨loguruè¿›è¡Œç»“æ„åŒ–æ—¥å¿—
- æ”¯æŒä¸åŒæ—¥å¿—çº§åˆ«
- ä¾¿äºç›‘æ§ç³»ç»Ÿé›†æˆ

## ğŸ”„ è¿ç§»å†å²

### ä»åˆ†æ•£ä»£ç åˆ°ç»Ÿä¸€æ¨¡å—
- **ä¹‹å‰**: ä»£ç åˆ†æ•£åœ¨ `run.py` å’Œç‹¬ç«‹è„šæœ¬ä¸­
- **ç°åœ¨**: ç»Ÿä¸€åœ¨ `WiseDataManager` ç±»ä¸­
- **ä¼˜åŠ¿**: æ›´å¥½çš„ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œå¯æ‰©å±•æ€§

### å¯åŠ¨æ—¶ç»´æŠ¤ä¼˜åŒ–
- **ä¹‹å‰**: æ¯æ¬¡å¯åŠ¨éƒ½æ‰§è¡Œç»´æŠ¤
- **ç°åœ¨**: å¯é€‰æ‰§è¡Œï¼Œé€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶
- **ä¼˜åŠ¿**: é¿å…ä¸å¿…è¦çš„å¯åŠ¨å»¶è¿Ÿ

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åºåˆ—ä¸åŒæ­¥**
   ```bash
   python -m app.utils.wise_data_manager --action fix-sequence
   ```

2. **é‡å¤è®°å½•**
   ```bash
   python -m app.utils.wise_data_manager --action clean-duplicates
   ```

3. **æ•°æ®çŠ¶æ€å¼‚å¸¸**
   ```bash
   python check_wise_data.py
   ```

### è°ƒè¯•æ¨¡å¼
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
LOGURU_LEVEL=DEBUG python check_wise_data.py
```

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `WiseDataManager` ç±»ä¸­æ·»åŠ æ–°æ–¹æ³•
2. æ›´æ–°å‘½ä»¤è¡Œå‚æ•°è§£æ
3. æ·»åŠ ç›¸åº”çš„æµ‹è¯•
4. æ›´æ–°æ–‡æ¡£

### æµ‹è¯•
```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
python -m pytest tests/test_wise_data_manager.py

# è¿è¡Œé›†æˆæµ‹è¯•
python check_wise_data.py
```

## ğŸ”® æœªæ¥è®¡åˆ’

- [ ] æ·»åŠ æ•°æ®å¤‡ä»½åŠŸèƒ½
- [ ] æ”¯æŒæ›´å¤šæ•°æ®æº
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§
- [ ] é›†æˆå‘Šè­¦ç³»ç»Ÿ
- [ ] æ”¯æŒæ‰¹é‡æ“ä½œ 