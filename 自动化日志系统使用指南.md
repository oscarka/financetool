# ğŸš€ è‡ªåŠ¨åŒ–æ—¥å¿—ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

è¿™ä¸ªè‡ªåŠ¨åŒ–æ—¥å¿—ç³»ç»Ÿè®©ä½ **åªéœ€è¦1-2è¡Œä»£ç **å°±èƒ½è·å¾—å®Œæ•´çš„æ—¥å¿—åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- âœ… è‡ªåŠ¨åˆ†ç±»ï¼ˆåŸºé‡‘ã€OKXã€Wiseã€PayPalç­‰ï¼‰
- âœ… è‡ªåŠ¨è®°å½•å‚æ•°ã€æ‰§è¡Œæ—¶é—´ã€å¼‚å¸¸
- âœ… è‡ªåŠ¨æ ¼å¼åŒ–è¾“å‡º
- âœ… è‡ªåŠ¨åœ¨Webç•Œé¢æ˜¾ç¤º
- âœ… é›¶é…ç½®ï¼Œå¼€ç®±å³ç”¨

## ğŸ¯ ä¸‰ç§ä½¿ç”¨æ–¹å¼

### æ–¹å¼1: è£…é¥°å™¨ - ä¸€è¡Œä»£ç æå®š

```python
from app.utils.auto_logger import auto_log

# åªéœ€è¦æ·»åŠ ä¸€è¡Œè£…é¥°å™¨ï¼
@auto_log("fund")  # è‡ªåŠ¨è®°å½•åŸºé‡‘APIè°ƒç”¨
async def get_fund_nav(fund_code: str):
    # ä½ çš„ä¸šåŠ¡ä»£ç ...
    return await api_call()

@auto_log("okx")  # è‡ªåŠ¨è®°å½•OKX APIè°ƒç”¨
async def get_okx_balance():
    # ä½ çš„ä¸šåŠ¡ä»£ç ...
    return await okx_api_call()

@auto_log("business")  # è‡ªåŠ¨è®°å½•ä¸šåŠ¡é€»è¾‘
def calculate_return(amount: float, rate: float):
    # ä½ çš„ä¸šåŠ¡ä»£ç ...
    return amount * rate
```

**è‡ªåŠ¨è·å¾—ï¼š**
- ğŸ“ å‡½æ•°è°ƒç”¨è®°å½•
- â±ï¸ æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
- ğŸ” å‚æ•°è®°å½•ï¼ˆè‡ªåŠ¨éšè—æ•æ„Ÿä¿¡æ¯ï¼‰
- âŒ å¼‚å¸¸æ•è·å’Œè®°å½•
- ğŸ“Š ç»“æœè®°å½•ï¼ˆå¯é€‰ï¼‰

### æ–¹å¼2: ä¸Šä¸‹æ–‡ç®¡ç†å™¨ - è®°å½•ä»£ç å—

```python
from app.utils.auto_logger import log_context

async def process_fund_order():
    # è®°å½•æ•´ä¸ªè®¢å•å¤„ç†æµç¨‹
    with log_context("business", "å¤„ç†åŸºé‡‘è®¢å•"):
        # 1. éªŒè¯ç”¨æˆ·
        with log_context("database", "éªŒè¯ç”¨æˆ·"):
            user = await validate_user(user_id)
        
        # 2. è·å–åŸºé‡‘ä¿¡æ¯
        with log_context("fund", "è·å–åŸºé‡‘ä¿¡æ¯"):
            fund_info = await get_fund_info(fund_code)
        
        # 3. ä¿å­˜è®¢å•
        with log_context("database", "ä¿å­˜è®¢å•"):
            order = await save_order(order_data)
```

**è‡ªåŠ¨è·å¾—ï¼š**
- ğŸ“ ä»£ç å—å¼€å§‹å’Œç»“æŸè®°å½•
- â±ï¸ æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡Œæ—¶é—´
- ğŸ”„ åµŒå¥—æ“ä½œçš„å±‚çº§å…³ç³»
- âŒ å¼‚å¸¸è‡ªåŠ¨è®°å½•

### æ–¹å¼3: ä¾¿æ·å‡½æ•° - ä¸€è¡Œä»£ç è®°å½•

```python
from app.utils.auto_logger import quick_log, log_success, log_failure

async def sync_fund_data(fund_code: str):
    try:
        result = await api_call()
        # è®°å½•æˆåŠŸ - ä¸€è¡Œä»£ç 
        quick_log("åŸºé‡‘æ•°æ®åŒæ­¥æˆåŠŸ", "fund", "INFO", 
                 fund_code=fund_code, nav=result["nav"])
        return result
    except Exception as e:
        # è®°å½•å¤±è´¥ - ä¸€è¡Œä»£ç 
        quick_log("åŸºé‡‘æ•°æ®åŒæ­¥å¤±è´¥", "fund", "ERROR", 
                 fund_code=fund_code, error=str(e))
        raise
```

## ğŸ¨ æœåŠ¡åˆ†ç±»æ˜ å°„

ç³»ç»Ÿè‡ªåŠ¨æ ¹æ®æœåŠ¡åç§°é€‰æ‹©å¯¹åº”çš„æ—¥å¿—åˆ†ç±»ï¼š

| æœåŠ¡åç§° | æ—¥å¿—åˆ†ç±» | ç”¨é€” |
|----------|----------|------|
| `"fund"` | ğŸ“ˆ åŸºé‡‘API | åŸºé‡‘æ•°æ®è·å–ã€å‡€å€¼åŒæ­¥ |
| `"okx"` | â‚¿ OKXäº¤æ˜“æ‰€ | åŠ å¯†è´§å¸äº¤æ˜“ã€è´¦æˆ·æŸ¥è¯¢ |
| `"wise"` | ğŸ’³ Wiseé‡‘è | å›½é™…è½¬è´¦ã€æ±‡ç‡æŸ¥è¯¢ |
| `"paypal"` | ğŸ’° PayPalæ”¯ä»˜ | æ”¯ä»˜äº¤æ˜“ã€è´¦æˆ·ä½™é¢ |
| `"exchange"` | ğŸ’± æ±‡ç‡æœåŠ¡ | æ±‡ç‡æ•°æ®è·å– |
| `"api"` | ğŸŒ APIæ¥å£ | å†…éƒ¨APIè°ƒç”¨ |
| `"database"` | ğŸ—„ï¸ æ•°æ®åº“ | æ•°æ®åº“æ“ä½œ |
| `"business"` | ğŸ’¼ ä¸šåŠ¡é€»è¾‘ | ä¸šåŠ¡æµç¨‹å¤„ç† |
| `"scheduler"` | â° å®šæ—¶ä»»åŠ¡ | å®šæ—¶ä»»åŠ¡æ‰§è¡Œ |
| `"system"` | ğŸ–¥ï¸ ç³»ç»Ÿè¿è¡Œ | ç³»ç»Ÿäº‹ä»¶ |
| `"security"` | ğŸ”’ å®‰å…¨ç›‘æ§ | å®‰å…¨äº‹ä»¶ |

## ğŸ”§ é«˜çº§é…ç½®

### è£…é¥°å™¨é«˜çº§é€‰é¡¹

```python
@auto_log(
    service="fund",           # æœåŠ¡åˆ†ç±»
    level="INFO",             # æ—¥å¿—çº§åˆ«
    log_args=True,            # æ˜¯å¦è®°å½•å‚æ•°
    log_result=True,          # æ˜¯å¦è®°å½•ç»“æœ
    log_time=True,            # æ˜¯å¦è®°å½•æ‰§è¡Œæ—¶é—´
    log_exceptions=True       # æ˜¯å¦è®°å½•å¼‚å¸¸
)
async def get_fund_nav(fund_code: str):
    return await api_call()
```

### APIè°ƒç”¨ä¸“ç”¨è£…é¥°å™¨

```python
@log_api_call(
    service="fund",           # æœåŠ¡åˆ†ç±»
    endpoint="/api/fund/nav", # APIç«¯ç‚¹
    method="GET",             # HTTPæ–¹æ³•
    timeout=30.0              # è¶…æ—¶æ—¶é—´
)
async def get_fund_nav(fund_code: str):
    return await httpx.get(f"https://api.example.com/fund/{fund_code}")
```

## ğŸš€ å¿«é€Ÿé›†æˆåˆ°ç°æœ‰ä»£ç 

### æ­¥éª¤1: å¯¼å…¥å·¥å…·

```python
from app.utils.auto_logger import auto_log, log_context, quick_log
```

### æ­¥éª¤2: ä¸ºå…³é”®å‡½æ•°æ·»åŠ è£…é¥°å™¨

```python
# åŸæ¥çš„ä»£ç 
async def get_fund_nav(fund_code: str):
    return await api_call()

# æ·»åŠ ä¸€è¡Œè£…é¥°å™¨
@auto_log("fund")
async def get_fund_nav(fund_code: str):
    return await api_call()
```

### æ­¥éª¤3: ä¸ºå¤æ‚æµç¨‹æ·»åŠ ä¸Šä¸‹æ–‡

```python
# åŸæ¥çš„ä»£ç 
async def process_order():
    user = await validate_user()
    fund = await get_fund_info()
    order = await save_order()

# æ·»åŠ ä¸Šä¸‹æ–‡ç®¡ç†å™¨
async def process_order():
    with log_context("business", "å¤„ç†è®¢å•"):
        with log_context("database", "éªŒè¯ç”¨æˆ·"):
            user = await validate_user()
        with log_context("fund", "è·å–åŸºé‡‘ä¿¡æ¯"):
            fund = await get_fund_info()
        with log_context("database", "ä¿å­˜è®¢å•"):
            order = await save_order()
```

### æ­¥éª¤4: æ·»åŠ å…³é”®æ—¥å¿—ç‚¹

```python
# åœ¨å…³é”®ä½ç½®æ·»åŠ ä¸€è¡Œæ—¥å¿—
quick_log("è®¢å•å¤„ç†æˆåŠŸ", "business", "INFO", order_id=order.id)
```

## ğŸ“Š è‡ªåŠ¨ç”Ÿæˆçš„æ—¥å¿—å†…å®¹

ä½¿ç”¨è‡ªåŠ¨åŒ–æ—¥å¿—ç³»ç»Ÿåï¼Œæ¯æ¡æ—¥å¿—éƒ½ä¼šè‡ªåŠ¨åŒ…å«ï¼š

```json
{
  "timestamp": "2024-01-15T10:30:45.123456",
  "level": "INFO",
  "category": "fund_api",
  "module": "fund_service",
  "function": "get_fund_nav",
  "line": 45,
  "message": "å‡½æ•°æ‰§è¡ŒæˆåŠŸ: fund_service.get_fund_nav",
  "extra_data": {
    "args_count": 1,
    "first_arg": "000001",
    "kwargs": {
      "nav_date": "2024-01-15"
    },
    "execution_time": 0.123,
    "status": "success",
    "result": {
      "fund_code": "000001",
      "nav": 1.2345
    }
  }
}
```

## ğŸ¯ å®é™…ä½¿ç”¨ç¤ºä¾‹

### åŸºé‡‘APIæœåŠ¡

```python
from app.utils.auto_logger import auto_log, log_api_call

class FundAPIService:
    @log_api_call("fund", "/api/fund/nav")
    async def get_fund_nav(self, fund_code: str):
        # è‡ªåŠ¨è®°å½•APIè°ƒç”¨è¯¦æƒ…
        return await self._call_api(fund_code)
    
    @auto_log("fund", log_result=True)
    async def batch_sync_funds(self, fund_codes: list):
        # è‡ªåŠ¨è®°å½•æ‰¹é‡æ“ä½œ
        results = []
        for code in fund_codes:
            result = await self.get_fund_nav(code)
            results.append(result)
        return results
```

### OKXäº¤æ˜“æ‰€æœåŠ¡

```python
class OKXAPIService:
    @log_api_call("okx", "/api/v5/account/balance")
    async def get_balance(self):
        # è‡ªåŠ¨è®°å½•OKX APIè°ƒç”¨
        return await self._call_okx_api()
    
    @auto_log("okx")
    async def sync_positions(self):
        # è‡ªåŠ¨è®°å½•æŒä»“åŒæ­¥
        return await self._sync_data()
```

### ä¸šåŠ¡é€»è¾‘æœåŠ¡

```python
class BusinessService:
    @auto_log("business")
    async def process_investment(self, user_id: int, amount: float):
        with log_context("database", "è·å–ç”¨æˆ·ä¿¡æ¯"):
            user = await self.get_user(user_id)
        
        with log_context("fund", "è·å–åŸºé‡‘ä¿¡æ¯"):
            fund = await self.get_fund_info()
        
        with log_context("business", "è®¡ç®—æŠ•èµ„"):
            shares = amount / fund.nav
        
        with log_context("database", "ä¿å­˜æŠ•èµ„è®°å½•"):
            investment = await self.save_investment(user_id, fund.code, shares)
        
        quick_log("æŠ•èµ„å¤„ç†æˆåŠŸ", "business", "INFO", 
                 user_id=user_id, amount=amount, shares=shares)
        
        return investment
```

## ğŸ” åœ¨Webç•Œé¢ä¸­æŸ¥çœ‹

éƒ¨ç½²åï¼Œè®¿é—® `/logs-viewer` å¯ä»¥çœ‹åˆ°ï¼š

1. **è‡ªåŠ¨åˆ†ç±»çš„æ—¥å¿—** - æ¯ä¸ªæœåŠ¡éƒ½æœ‰ç‹¬ç«‹çš„åˆ†ç±»
2. **è¯¦ç»†çš„æ‰§è¡Œä¿¡æ¯** - å‚æ•°ã€æ—¶é—´ã€ç»“æœ
3. **å¼‚å¸¸è¿½è¸ª** - å®Œæ•´çš„é”™è¯¯ä¿¡æ¯å’Œå †æ ˆ
4. **æ€§èƒ½ç»Ÿè®¡** - æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ
5. **å®æ—¶ç›‘æ§** - è‡ªåŠ¨åˆ·æ–°æœ€æ–°æ—¥å¿—

## ğŸ‰ æ€»ç»“

ä½¿ç”¨è‡ªåŠ¨åŒ–æ—¥å¿—ç³»ç»Ÿçš„å¥½å¤„ï¼š

âœ… **é›¶é…ç½®** - å¼€ç®±å³ç”¨ï¼Œæ— éœ€å¤æ‚è®¾ç½®  
âœ… **ä¸€è¡Œä»£ç ** - åªéœ€è¦æ·»åŠ ä¸€ä¸ªè£…é¥°å™¨  
âœ… **è‡ªåŠ¨åˆ†ç±»** - æ ¹æ®æœåŠ¡è‡ªåŠ¨å½’ç±»  
âœ… **å®Œæ•´è®°å½•** - å‚æ•°ã€æ—¶é—´ã€å¼‚å¸¸ã€ç»“æœ  
âœ… **å®‰å…¨å¤„ç†** - è‡ªåŠ¨éšè—æ•æ„Ÿä¿¡æ¯  
âœ… **Webç•Œé¢** - ç¾è§‚çš„æ—¥å¿—æŸ¥çœ‹å™¨  
âœ… **å®æ—¶ç›‘æ§** - è‡ªåŠ¨åˆ·æ–°å’Œç»Ÿè®¡  

**ç°åœ¨ä½ åªéœ€è¦å…³å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæ—¥å¿—ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ä¸€åˆ‡ï¼** ğŸš€