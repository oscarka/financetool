# åŸºé‡‘æ¨¡å—APIæ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

åŸºé‡‘æ¨¡å—æä¾›äº†å®Œæ•´çš„åŸºé‡‘æŠ•èµ„ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ“ä½œè®°å½•ã€å‡€å€¼ç®¡ç†ã€æŒä»“è®¡ç®—ã€å®šæŠ•è®¡åˆ’ç­‰ã€‚

## ğŸ”— åŸºç¡€ä¿¡æ¯

- **åŸºç¡€URL**: `http://localhost:8000/api/v1/funds`
- **è®¤è¯**: æš‚æ— ï¼ˆå¼€å‘é˜¶æ®µï¼‰
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

## ğŸ“Š å“åº”æ ¼å¼

æ‰€æœ‰APIéƒ½ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼š

```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    // å…·ä½“æ•°æ®
  }
}
```

## ğŸ¯ APIæ¥å£åˆ—è¡¨

### 1. åŸºé‡‘æ“ä½œè®°å½•

#### 1.1 åˆ›å»ºåŸºé‡‘æ“ä½œè®°å½•
- **URL**: `POST /operations`
- **æè¿°**: åˆ›å»ºä¹°å…¥ã€å–å‡ºç­‰åŸºé‡‘æ“ä½œè®°å½•
- **è¯·æ±‚ä½“**:
```json
{
  "operation_date": "2024-01-15T15:00:00",
  "operation_type": "buy",
  "asset_code": "000001",
  "asset_name": "åå¤æˆé•¿æ··åˆ",
  "amount": 1000.0,
  "strategy": "å®šæŠ•ç­–ç•¥",
  "emotion_score": 7,
  "notes": "ä¹°å…¥æ“ä½œ"
}
```
- **å“åº”**: è¿”å›åˆ›å»ºçš„æ“ä½œè®°å½•

#### 1.2 è·å–åŸºé‡‘æ“ä½œè®°å½•
- **URL**: `GET /operations`
- **æè¿°**: è·å–åŸºé‡‘æ“ä½œå†å²è®°å½•
- **æŸ¥è¯¢å‚æ•°**:
  - `asset_code`: åŸºé‡‘ä»£ç ï¼ˆå¯é€‰ï¼‰
  - `operation_type`: æ“ä½œç±»å‹ï¼ˆå¯é€‰ï¼‰
  - `start_date`: å¼€å§‹æ—¥æœŸï¼ˆå¯é€‰ï¼‰
  - `end_date`: ç»“æŸæ—¥æœŸï¼ˆå¯é€‰ï¼‰
  - `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
  - `page_size`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- **å“åº”**: è¿”å›æ“ä½œè®°å½•åˆ—è¡¨

#### 1.3 æ›´æ–°åŸºé‡‘æ“ä½œè®°å½•
- **URL**: `PUT /operations/{operation_id}`
- **æè¿°**: æ›´æ–°æ“ä½œè®°å½•çš„ä»½é¢ã€ä»·æ ¼ç­‰ä¿¡æ¯
- **è¯·æ±‚ä½“**:
```json
{
  "quantity": 1000.0,
  "price": 1.2345,
  "fee": 15.0,
  "status": "confirmed",
  "notes": "ç¡®è®¤ä»½é¢"
}
```

#### 1.4 åˆ é™¤åŸºé‡‘æ“ä½œè®°å½•
- **URL**: `DELETE /operations/{operation_id}`
- **æè¿°**: åˆ é™¤æŒ‡å®šçš„æ“ä½œè®°å½•

### 2. åŸºé‡‘æŒä»“ç®¡ç†

#### 2.1 è·å–åŸºé‡‘æŒä»“åˆ—è¡¨
- **URL**: `GET /positions`
- **æè¿°**: è·å–å½“å‰æ‰€æœ‰åŸºé‡‘æŒä»“ä¿¡æ¯
- **å“åº”**: è¿”å›æŒä»“åˆ—è¡¨ï¼ŒåŒ…å«æ”¶ç›Šè®¡ç®—

#### 2.2 è·å–æŒä»“æ±‡æ€»ä¿¡æ¯
- **URL**: `GET /positions/summary`
- **æè¿°**: è·å–æŒä»“æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯
- **å“åº”**:
```json
{
  "total_invested": 50000.0,
  "total_value": 52000.0,
  "total_profit": 2000.0,
  "total_profit_rate": 0.04,
  "asset_count": 5,
  "profitable_count": 3,
  "loss_count": 2
}
```

### 3. åŸºé‡‘å‡€å€¼ç®¡ç†

#### 3.1 æ‰‹åŠ¨å½•å…¥åŸºé‡‘å‡€å€¼
- **URL**: `POST /nav`
- **æè¿°**: æ‰‹åŠ¨å½•å…¥åŸºé‡‘å‡€å€¼æ•°æ®
- **è¯·æ±‚ä½“**:
```json
{
  "fund_code": "000001",
  "nav_date": "2024-01-15",
  "nav": 1.2345,
  "accumulated_nav": 2.3456,
  "growth_rate": 0.015,
  "source": "manual"
}
```

#### 3.2 è·å–åŸºé‡‘å‡€å€¼å†å²
- **URL**: `GET /nav/{fund_code}`
- **æè¿°**: è·å–æŒ‡å®šåŸºé‡‘çš„å‡€å€¼å†å²
- **æŸ¥è¯¢å‚æ•°**:
  - `days`: è·å–å¤©æ•°ï¼ˆé»˜è®¤30ï¼Œæœ€å¤§365ï¼‰

#### 3.3 è·å–åŸºé‡‘æœ€æ–°å‡€å€¼
- **URL**: `GET /nav/{fund_code}/latest`
- **æè¿°**: è·å–æŒ‡å®šåŸºé‡‘çš„æœ€æ–°å‡€å€¼

#### 3.4 åŒæ­¥åŸºé‡‘å‡€å€¼
- **URL**: `POST /nav/{fund_code}/sync`
- **æè¿°**: ä»å¤–éƒ¨APIåŒæ­¥åŸºé‡‘å‡€å€¼
- **æŸ¥è¯¢å‚æ•°**:
  - `nav_date`: å‡€å€¼æ—¥æœŸ

### 4. åŸºé‡‘ä¿¡æ¯ç®¡ç†

#### 4.1 åˆ›å»ºåŸºé‡‘ä¿¡æ¯
- **URL**: `POST /info`
- **æè¿°**: åˆ›å»ºåŸºé‡‘åŸºæœ¬ä¿¡æ¯
- **è¯·æ±‚ä½“**:
```json
{
  "fund_code": "000001",
  "fund_name": "åå¤æˆé•¿æ··åˆ",
  "fund_type": "æ··åˆå‹",
  "management_fee": 0.015,
  "purchase_fee": 0.015,
  "redemption_fee": 0.005,
  "min_purchase": 100.0,
  "risk_level": "ä¸­é£é™©"
}
```

#### 4.2 è·å–æ‰€æœ‰åŸºé‡‘ä¿¡æ¯
- **URL**: `GET /info`
- **æè¿°**: è·å–æ‰€æœ‰åŸºé‡‘çš„åŸºæœ¬ä¿¡æ¯

#### 4.3 è·å–åŸºé‡‘ä¿¡æ¯
- **URL**: `GET /info/{fund_code}`
- **æè¿°**: è·å–æŒ‡å®šåŸºé‡‘çš„è¯¦ç»†ä¿¡æ¯

#### 4.4 æ›´æ–°åŸºé‡‘ä¿¡æ¯
- **URL**: `PUT /info/{fund_code}`
- **æè¿°**: æ›´æ–°åŸºé‡‘ä¿¡æ¯

#### 4.5 åŒæ­¥åŸºé‡‘ä¿¡æ¯
- **URL**: `POST /info/{fund_code}/sync`
- **æè¿°**: ä»å¤–éƒ¨APIåŒæ­¥åŸºé‡‘ä¿¡æ¯

### 5. å®šæŠ•è®¡åˆ’ç®¡ç†

#### 5.1 åˆ›å»ºå®šæŠ•è®¡åˆ’
- **URL**: `POST /dca/plans`
- **æè¿°**: åˆ›å»ºå®šæŠ•è®¡åˆ’
- **è¯·æ±‚ä½“**:
```json
{
  "plan_name": "åå¤æˆé•¿å®šæŠ•",
  "asset_code": "000001",
  "asset_name": "åå¤æˆé•¿æ··åˆ",
  "amount": 500.0,
  "currency": "CNY",
  "frequency": "monthly",
  "frequency_value": 30,
  "start_date": "2024-01-15",
  "strategy": "æ¯æœˆå®šæŠ•500å…ƒ"
}
```

#### 5.2 è·å–å®šæŠ•è®¡åˆ’åˆ—è¡¨
- **URL**: `GET /dca/plans`
- **æè¿°**: è·å–æ‰€æœ‰å®šæŠ•è®¡åˆ’
- **æŸ¥è¯¢å‚æ•°**:
  - `status`: è®¡åˆ’çŠ¶æ€ï¼ˆå¯é€‰ï¼‰

#### 5.3 æ›´æ–°å®šæŠ•è®¡åˆ’
- **URL**: `PUT /dca/plans/{plan_id}`
- **æè¿°**: æ›´æ–°å®šæŠ•è®¡åˆ’ä¿¡æ¯

#### 5.4 åˆ é™¤å®šæŠ•è®¡åˆ’
- **URL**: `DELETE /dca/plans/{plan_id}`
- **æè¿°**: åˆ é™¤å®šæŠ•è®¡åˆ’

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### Pythonç¤ºä¾‹

```python
import httpx
import asyncio

async def test_fund_api():
    async with httpx.AsyncClient() as client:
        # åˆ›å»ºåŸºé‡‘ä¿¡æ¯
        fund_data = {
            "fund_code": "000001",
            "fund_name": "åå¤æˆé•¿æ··åˆ",
            "fund_type": "æ··åˆå‹"
        }
        response = await client.post(
            "http://localhost:8000/api/v1/funds/info",
            json=fund_data
        )
        print(response.json())
        
        # åˆ›å»ºæ“ä½œè®°å½•
        operation_data = {
            "operation_date": "2024-01-15T15:00:00",
            "operation_type": "buy",
            "asset_code": "000001",
            "asset_name": "åå¤æˆé•¿æ··åˆ",
            "amount": 1000.0
        }
        response = await client.post(
            "http://localhost:8000/api/v1/funds/operations",
            json=operation_data
        )
        print(response.json())

# è¿è¡Œæµ‹è¯•
asyncio.run(test_fund_api())
```

### cURLç¤ºä¾‹

```bash
# è·å–åŸºé‡‘æŒä»“
curl -X GET "http://localhost:8000/api/v1/funds/positions"

# åˆ›å»ºåŸºé‡‘æ“ä½œ
curl -X POST "http://localhost:8000/api/v1/funds/operations" \
  -H "Content-Type: application/json" \
  -d '{
    "operation_date": "2024-01-15T15:00:00",
    "operation_type": "buy",
    "asset_code": "000001",
    "asset_name": "åå¤æˆé•¿æ··åˆ",
    "amount": 1000.0
  }'

# åŒæ­¥åŸºé‡‘å‡€å€¼
curl -X POST "http://localhost:8000/api/v1/funds/nav/000001/sync?nav_date=2024-01-15"
```

## ğŸš¨ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç 

- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `404`: èµ„æºä¸å­˜åœ¨
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "detail": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ—¥æœŸæ ¼å¼**: ä½¿ç”¨ISO 8601æ ¼å¼ï¼ˆYYYY-MM-DDæˆ–YYYY-MM-DDTHH:MM:SSï¼‰
2. **é‡‘é¢æ ¼å¼**: ä½¿ç”¨Decimalç±»å‹ï¼Œæ”¯æŒ4ä½å°æ•°
3. **åŸºé‡‘ä»£ç **: 6ä½æ•°å­—ä»£ç 
4. **æ“ä½œç±»å‹**: buyï¼ˆä¹°å…¥ï¼‰ã€sellï¼ˆå–å‡ºï¼‰ã€dividendï¼ˆåˆ†çº¢ï¼‰
5. **æ•°æ®åŒæ­¥**: å¤–éƒ¨APIå¯èƒ½ä¸ç¨³å®šï¼Œå»ºè®®æ·»åŠ é‡è¯•æœºåˆ¶

## ğŸ”„ æ•°æ®åŒæ­¥

ç³»ç»Ÿæ”¯æŒä»ä»¥ä¸‹æ•°æ®æºåŒæ­¥åŸºé‡‘æ•°æ®ï¼š

- **å¤©å¤©åŸºé‡‘ç½‘**: ä¸»è¦æ•°æ®æºï¼Œæä¾›åŸºé‡‘å‡€å€¼å’ŒåŸºæœ¬ä¿¡æ¯
- **é›ªçƒ**: å¤‡ç”¨æ•°æ®æºï¼Œæä¾›åŸºé‡‘å‡€å€¼

åŒæ­¥åŠŸèƒ½é€šè¿‡ä»¥ä¸‹APIå®ç°ï¼š
- `POST /nav/{fund_code}/sync`: åŒæ­¥åŸºé‡‘å‡€å€¼
- `POST /info/{fund_code}/sync`: åŒæ­¥åŸºé‡‘ä¿¡æ¯ 