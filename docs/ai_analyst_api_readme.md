# AIåˆ†æå¸ˆæ•°æ®APIé¡¹ç›®

## æ¦‚è¿°

æœ¬é¡¹ç›®ä¸ºå¤–éƒ¨AIåˆ†æå¸ˆæä¾›**åŸå§‹èµ„äº§æ•°æ®å’ŒåŸºç¡€è®¡ç®—ç»“æœ**ï¼Œä¸“æ³¨äºæ•°æ®æä¾›è€Œéåˆ†æç»“è®ºã€‚AIåˆ†æå¸ˆå¯ä»¥åŸºäºè¿™äº›é«˜è´¨é‡çš„æ•°æ®è¿›è¡Œç‹¬ç«‹åˆ†æå’Œå†³ç­–ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹ç‚¹

- **æ•°æ®ä¼˜å…ˆ**: æä¾›åŸå§‹æ•°æ®ï¼Œä¸åšä¸»è§‚åˆ†æ
- **å¤šç»´åº¦**: æ”¯æŒèµ„äº§ã€äº¤æ˜“ã€å†å²ã€å¸‚åœºã€å®šæŠ•ç­‰å¤šç±»æ•°æ®
- **å®æ—¶æ€§**: åŸºäºæœ€æ–°å¿«ç…§çš„å‡†ç¡®æ•°æ®
- **å®Œæ•´æ€§**: è·¨å¹³å°ã€å¤šå¸ç§ã€å¤šèµ„äº§ç±»å‹æ•´åˆ
- **ç®€æ´API**: å†…éƒ¨ä½¿ç”¨ï¼Œæ¥å£è®¾è®¡ç®€åŒ–å®ç”¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡
```bash
cd backend
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. è®¿é—®æµ‹è¯•é¡µé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:8000/api/v1/ai-analyst/playground
```

è¿™ä¸ªå†…ç½®çš„æµ‹è¯•é¡µé¢æä¾›äº†ï¼š
- ğŸ® **å¯è§†åŒ–æµ‹è¯•ç•Œé¢**: ç›´è§‚çš„APIæµ‹è¯•å·¥å…·
- ğŸ“Š **å®æ—¶æ•°æ®é¢„è§ˆ**: ç«‹å³æŸ¥çœ‹APIè¿”å›çš„æ•°æ®ç»“æ„
- ğŸ”§ **å‚æ•°è°ƒæ•´**: ç®€å•ä¿®æ”¹APIå‚æ•°è¿›è¡Œæµ‹è¯•
- ğŸ“‹ **ä¸€é”®å¤åˆ¶**: å¿«é€Ÿè·å–APIè°ƒç”¨ç¤ºä¾‹

### 3. APIè®¤è¯
ä½¿ç”¨å†…ç½®æµ‹è¯•å¯†é’¥ï¼š
- `ai_analyst_key_2024` (ä¸»è¦æµ‹è¯•å¯†é’¥)
- `demo_key_12345` (å¤‡ç”¨å¯†é’¥)

## ğŸ“¡ APIæ¥å£æ¦‚è§ˆ

### æ ¸å¿ƒæ•°æ®æ¥å£

| æ¥å£ | æè¿° | ç”¨é€” |
|------|------|------|
| `/asset-data` | å½“å‰èµ„äº§æŒä»“å¿«ç…§ | æŠ•èµ„ç»„åˆåˆ†æã€é…ç½®è¯„ä¼° |
| `/transaction-data` | äº¤æ˜“å†å²è®°å½• | è¡Œä¸ºåˆ†æã€ç­–ç•¥è¯†åˆ« |
| `/historical-data` | å†å²ä»·å€¼æ•°æ® | ç»©æ•ˆè®¡ç®—ã€è¶‹åŠ¿åˆ†æ |
| `/market-data` | å¸‚åœºç¯å¢ƒæ•°æ® | æ±‡ç‡å½±å“ã€åŸºå‡†å¯¹æ¯” |
| `/dca-data` | å®šæŠ•è®¡åˆ’æ•°æ® | æˆæœ¬å¹³å‡æ•ˆåº”åˆ†æ |
| `/health` | æœåŠ¡å¥åº·æ£€æŸ¥ | ç³»ç»ŸçŠ¶æ€ç›‘æ§ |

### å†…ç½®å·¥å…·

| è·¯å¾„ | æè¿° |
|------|------|
| `/playground` | ğŸ® **APIæµ‹è¯•é¡µé¢** - å¯è§†åŒ–æµ‹è¯•å·¥å…· |
| `/docs` | ğŸ“š è‡ªåŠ¨ç”Ÿæˆçš„OpenAPIæ–‡æ¡£ |

## ğŸ” æ•°æ®ç»“æ„ç¤ºä¾‹

### èµ„äº§æ•°æ® (`/asset-data`)
```json
{
  "current_holdings": [
    {
      "platform": "æ”¯ä»˜å®åŸºé‡‘",
      "asset_code": "000001",
      "asset_name": "åå¤æˆé•¿æ··åˆ",
      "balance_cny": 25000.00,
      "balance_usd": 3571.43,
      "extra_data": {
        "fund_type": "æ··åˆå‹",
        "risk_level": "ä¸­é«˜é£é™©"
      }
    }
  ],
  "platform_summary": [...],
  "asset_type_summary": [...]
}
```

### äº¤æ˜“æ•°æ® (`/transaction-data`)
```json
{
  "transactions": [
    {
      "date": "2024-01-15T09:30:00",
      "operation_type": "buy",
      "amount": 1000.00,
      "emotion_score": 7,
      "strategy": "å®šæŠ•è®¡åˆ’"
    }
  ],
  "summary_stats": {...},
  "time_series_data": [...]
}
```

## ğŸ¤– AIåˆ†æå¸ˆä½¿ç”¨æŒ‡å—

### 1. **æŠ•èµ„ç»„åˆåˆ†æ**
```python
# è·å–èµ„äº§æ•°æ®
asset_data = api_client.get('/asset-data')

# è®¡ç®—é›†ä¸­åº¦é£é™© (HHIæŒ‡æ•°)
holdings = asset_data['current_holdings'] 
total_value = sum(h['base_currency_value'] for h in holdings)
weights = [h['base_currency_value'] / total_value for h in holdings]
hhi = sum(w**2 for w in weights) * 10000

# è¯„ä¼°åˆ†æ•£åŒ–ç¨‹åº¦
platform_count = len(asset_data['platform_summary'])
risk_level = "ä½" if hhi < 1500 else "ä¸­" if hhi < 2500 else "é«˜"
```

### 2. **è¡Œä¸ºæ¨¡å¼åˆ†æ**
```python
# è·å–äº¤æ˜“æ•°æ®
tx_data = api_client.get('/transaction-data')

# åˆ†ææŠ•èµ„çºªå¾‹æ€§
buy_ops = [t for t in tx_data['transactions'] if t['operation_type'] == 'buy']
amounts = [t['amount'] for t in buy_ops]
consistency = 1 - (std(amounts) / mean(amounts))

# æƒ…ç»ªè¶‹åŠ¿åˆ†æ
emotions = [t['emotion_score'] for t in tx_data['transactions']]
emotion_trend = analyze_linear_trend(emotions)
```

### 3. **ç»©æ•ˆè®¡ç®—**
```python
# è·å–å†å²æ•°æ®
hist_data = api_client.get('/historical-data?days=90')

# è®¡ç®—æ”¶ç›Šç‡å’Œæ³¢åŠ¨ç‡
values = [d['base_value'] for d in hist_data['asset_values']]
total_return = (values[-1] - values[0]) / values[0]
daily_returns = calculate_daily_returns(values)
volatility = std(daily_returns) * sqrt(252)
```

## ğŸ› ï¸ å¼€å‘å’Œéƒ¨ç½²

### é¡¹ç›®ç»“æ„
```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/v1/
â”‚   â”‚   â””â”€â”€ ai_analyst.py      # æ ¸å¿ƒAPIæ¥å£
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â””â”€â”€ asset_snapshot.py  # å¿«ç…§æ¨¡å‹
â”‚   â””â”€â”€ main.py               # FastAPIåº”ç”¨
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ ai_analyst_client.py  # Pythonå®¢æˆ·ç«¯ç¤ºä¾‹
â”‚   â””â”€â”€ ai_analyst_client.js  # JavaScriptå®¢æˆ·ç«¯ç¤ºä¾‹
â””â”€â”€ docs/
    â”œâ”€â”€ ai_analyst_api_documentation.md  # è¯¦ç»†APIæ–‡æ¡£
    â””â”€â”€ ai_analyst_api_readme.md         # é¡¹ç›®è¯´æ˜
```

### æŠ€æœ¯æ ˆ
- **åç«¯**: FastAPI + SQLAlchemy + Pydantic
- **æ•°æ®åº“**: PostgreSQL (æ¨è) / MySQL / SQLite
- **è®¤è¯**: API Key (Header: X-API-Key)
- **æ–‡æ¡£**: è‡ªåŠ¨ç”ŸæˆOpenAPIæ–‡æ¡£

### ç¯å¢ƒè¦æ±‚
```bash
pip install fastapi uvicorn sqlalchemy pydantic-settings
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### API Keyç®¡ç†
- å†…éƒ¨ä½¿ç”¨ï¼Œå¯†é’¥ç›¸å¯¹ç®€å•
- ç”Ÿäº§ç¯å¢ƒè¯·æ›´æ¢ä¸ºå¤æ‚å¯†é’¥
- è€ƒè™‘æ·»åŠ IPç™½åå•é™åˆ¶

### æ•°æ®è®¿é—®
- å½“å‰æ— ç”¨æˆ·éš”ç¦»ï¼Œè¿”å›æ‰€æœ‰æ•°æ®
- ç”Ÿäº§ç¯å¢ƒå¯æ ¹æ®éœ€è¦æ·»åŠ ç”¨æˆ·æƒé™æ§åˆ¶
- æ•æ„Ÿæ•°æ®å¯åœ¨extra_dataä¸­æ§åˆ¶è¿”å›

## ğŸ“ˆ æ•°æ®è´¨é‡

### æ•°æ®æ¥æº
- **èµ„äº§å¿«ç…§**: æ¯æ—¥è‡ªåŠ¨æŠ“å–å„å¹³å°æ•°æ®
- **äº¤æ˜“è®°å½•**: ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ + éƒ¨åˆ†è‡ªåŠ¨åŒæ­¥  
- **å‡€å€¼æ•°æ®**: ç¬¬ä¸‰æ–¹APIå®æ—¶è·å–
- **æ±‡ç‡æ•°æ®**: akshareç­‰æ•°æ®æºï¼Œ15åˆ†é’Ÿæ›´æ–°

### æ•°æ®å®Œæ•´æ€§
- æ‰€æœ‰è´§å¸é‡‘é¢ç²¾ç¡®åˆ°2ä½å°æ•°
- æ•°é‡/ä»½é¢ç²¾ç¡®åˆ°8ä½å°æ•°
- æ—¶é—´æˆ³ä½¿ç”¨ISO 8601æ ¼å¼
- ç¼ºå¤±æ•°æ®æ ‡è®°ä¸º`null`

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. APIè¿”å›404é”™è¯¯**
- æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰AssetSnapshotæ•°æ®
- ç¡®è®¤æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®

**2. ç©ºæ•°æ®è¿”å›**
- æ£€æŸ¥æ—¶é—´èŒƒå›´å‚æ•°æ˜¯å¦åˆç†
- ç¡®è®¤ç­›é€‰æ¡ä»¶ä¸ä¼šè¿‡åº¦é™åˆ¶ç»“æœ

**3. æ€§èƒ½é—®é¢˜**
- é€‚å½“ä½¿ç”¨limitå‚æ•°é™åˆ¶è¿”å›æ•°æ®é‡
- è€ƒè™‘ä¸ºå¤§è¡¨æ·»åŠ ç´¢å¼•

### æ—¥å¿—ç›‘æ§
```python
import logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)
```

## ğŸš€ ä½¿ç”¨å»ºè®®

### æœ€ä½³å®è·µ
1. **æµ‹è¯•ä¼˜å…ˆ**: ä½¿ç”¨`/playground`é¡µé¢å¿«é€ŸéªŒè¯æ¥å£
2. **å‚æ•°ä¼˜åŒ–**: æ ¹æ®éœ€è¦è°ƒæ•´`days`ã€`limit`ç­‰å‚æ•°
3. **é”™è¯¯å¤„ç†**: å®ç°é‡è¯•æœºåˆ¶å’Œé™çº§ç­–ç•¥
4. **æ•°æ®ç¼“å­˜**: å¯¹ä¸ç»å¸¸å˜åŒ–çš„æ•°æ®è¿›è¡Œæœ¬åœ°ç¼“å­˜

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨åˆç†çš„æ—¶é—´èŒƒå›´æŸ¥è¯¢
- æ‰¹é‡å¤„ç†å¤šä¸ªèµ„äº§çš„æ•°æ®è¯·æ±‚
- è€ƒè™‘å¼‚æ­¥è°ƒç”¨æé«˜æ•ˆç‡

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **APIæµ‹è¯•**: è®¿é—® `/playground` é¡µé¢
- **APIæ–‡æ¡£**: è®¿é—® `/docs` æŸ¥çœ‹è¯¦ç»†æ¥å£æ–‡æ¡£
- **ç¤ºä¾‹ä»£ç **: å‚è€ƒ `examples/` ç›®å½•ä¸‹çš„å®¢æˆ·ç«¯å®ç°

---

**é‡è¦æé†’**: æœ¬APIä¸“æ³¨äºæ•°æ®æä¾›ï¼Œä¸åŒ…å«æŠ•èµ„å»ºè®®ã€‚AIåˆ†æå¸ˆåº”åŸºäºè‡ªèº«ç®—æ³•å’Œæ¨¡å‹å¯¹æ•°æ®è¿›è¡Œåˆ†æï¼Œä¸ºç”¨æˆ·æä¾›ä¸ªæ€§åŒ–æœåŠ¡ã€‚