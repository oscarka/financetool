# 开发计划文档

## 🎯 总体开发策略

### 核心理念
- **用户只需记录决策**：系统自动处理数据获取和计算
- **分模块验证**：每个模块独立开发，确保可运行可验证
- **渐进式开发**：从简单到复杂，每个阶段都有可用的产品

### 开发优先级
1. **基金模块**（网络稳定，API丰富）
2. **OKX模块**（网络问题解决后）
3. **Wise模块**（外汇管理）
4. **银行理财模块**（固定收益）
5. **统一分析模块**（全局视图）

## 🚀 第一阶段：基金模块开发

### 目标
创建一个完整的基金投资记录系统，支持操作记录、净值同步、收益计算

### 开发周期：2-3周

#### 第1周：基础架构搭建

**Day 1-2：项目初始化**
- [ ] 创建项目目录结构
- [ ] 设置前端开发环境（React + TypeScript + Vite）
- [ ] 设置后端开发环境（FastAPI + SQLite）
- [ ] 配置数据库和基础表结构
- [ ] 创建基础API接口

**Day 3-4：基金操作记录功能**
- [ ] 基金操作录入界面
- [ ] 基金信息管理（代码、名称、费率等）
- [ ] 基础持仓计算逻辑
- [ ] 操作历史查看界面

**Day 5-7：净值管理功能**
- [ ] 手动净值录入界面
- [ ] 净值历史记录
- [ ] 基础收益计算
- [ ] 持仓状态展示

**验证目标：**
- ✅ 能够录入基金买入/卖出操作
- ✅ 能够手动录入净值数据
- ✅ 能够查看当前持仓和收益
- ✅ 能够查看操作历史

#### 第2周：API集成和自动化

**Day 8-10：基金API集成**
- [ ] 天天基金网API集成
- [ ] 自动净值同步功能
- [ ] 净值数据验证机制
- [ ] 异常处理和数据回退

**Day 11-12：智能计算功能**
- [ ] 自动份额计算
- [ ] 平均成本计算
- [ ] 收益自动更新
- [ ] 数据一致性检查

**Day 13-14：用户体验优化**
- [ ] 净值确认机制
- [ ] 数据修正功能
- [ ] 操作提醒功能
- [ ] 错误提示优化

**验证目标：**
- ✅ 自动获取基金净值
- ✅ 自动计算买入份额
- ✅ 收益实时更新
- ✅ 数据异常提醒

#### 第3周：高级功能

**Day 15-17：定投计划管理**
- [ ] 定投计划设置界面
- [ ] 定投执行逻辑
- [ ] 定投提醒功能
- [ ] 定投效果分析

**Day 18-19：分析功能**
- [ ] 收益趋势图表
- [ ] 操作分析统计
- [ ] 基金对比功能
- [ ] 数据导出功能

**Day 20-21：测试和优化**
- [ ] 功能测试
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 文档完善

**验证目标：**
- ✅ 定投计划自动执行
- ✅ 收益分析图表展示
- ✅ 操作效果分析
- ✅ 数据导出功能

## 📋 具体开发任务

### 后端开发任务

#### 1. 数据库模型设计
```python
# 需要创建的表
- user_operations (用户操作记录)
- fund_info (基金信息)
- fund_nav (基金净值)
- asset_positions (资产持仓)
- dca_plans (定投计划)
```

#### 2. API接口开发
```python
# 基金操作API
POST /api/v1/funds/operations     # 创建操作记录
GET /api/v1/funds/operations      # 获取操作历史
PUT /api/v1/funds/operations/{id} # 更新操作记录

# 基金净值API
GET /api/v1/funds/{code}/nav      # 获取净值历史
POST /api/v1/funds/{code}/nav     # 手动录入净值
PUT /api/v1/funds/{code}/nav      # 确认净值

# 持仓API
GET /api/v1/positions/funds       # 获取基金持仓
GET /api/v1/positions/summary     # 获取持仓汇总

# 定投API
POST /api/v1/dca/plans           # 创建定投计划
GET /api/v1/dca/plans            # 获取定投计划
PUT /api/v1/dca/plans/{id}       # 更新定投计划
```

#### 3. 业务逻辑开发
```python
# 核心服务类
- FundOperationService (基金操作服务)
- FundNavService (基金净值服务)
- PositionCalculationService (持仓计算服务)
- DCAService (定投服务)
- FundAPIService (基金API服务)
```

### 前端开发任务

#### 1. 页面组件开发
```typescript
// 主要页面
- Dashboard (总览页面)
- FundOperations (基金操作页面)
- FundPositions (基金持仓页面)
- FundAnalysis (基金分析页面)
- DCAPlans (定投计划页面)
```

#### 2. 组件开发
```typescript
// 表单组件
- FundOperationForm (基金操作表单)
- FundNavForm (净值录入表单)
- DCAPlanForm (定投计划表单)

// 展示组件
- FundPositionTable (持仓表格)
- FundOperationTable (操作历史表格)
- FundProfitChart (收益图表)
- FundNavChart (净值图表)
```

#### 3. 状态管理
```typescript
// Zustand stores
- useFundStore (基金状态管理)
- useOperationStore (操作状态管理)
- usePositionStore (持仓状态管理)
```

## 🧪 测试计划

### 单元测试
- [ ] 基金收益计算逻辑测试
- [ ] 净值同步功能测试
- [ ] 定投执行逻辑测试
- [ ] API接口测试

### 集成测试
- [ ] 基金操作完整流程测试
- [ ] 数据同步和计算测试
- [ ] 前端后端交互测试

### 用户测试
- [ ] 基金操作录入测试
- [ ] 净值确认流程测试
- [ ] 定投计划设置测试
- [ ] 数据分析功能测试

## 📊 验证标准

### 功能验证
1. **操作记录准确性**
   - 录入买入1000元，系统正确计算份额
   - 录入卖出操作，系统正确计算收益
   - 操作历史完整记录

2. **净值同步准确性**
   - 自动获取净值与手动录入一致
   - 净值变化异常时正确提醒
   - 净值确认机制正常工作

3. **收益计算准确性**
   - 累计收益计算正确
   - 收益率计算正确
   - 收益变化实时更新

4. **定投功能准确性**
   - 定投计划按时执行
   - 定投金额和频率正确
   - 定投效果分析准确

### 性能验证
- 页面加载时间 < 2秒
- 数据同步时间 < 5秒
- 并发操作支持
- 数据一致性保证

### 用户体验验证
- 界面操作流畅
- 错误提示清晰
- 数据展示直观
- 功能易于理解

## 🔄 后续阶段规划

### 第二阶段：OKX模块 (2周)
- OKX API集成
- 数字货币操作记录
- 实时价格同步
- 多账户管理

### 第三阶段：Wise模块 (1周)
- Wise API集成
- 外汇账户管理
- 汇率同步
- 多币种转换

### 第四阶段：统一分析 (1周)
- 全局资产视图
- 跨平台收益分析
- 风险分析
- 投资建议

## 📝 开发规范

### 代码规范
- 使用TypeScript进行类型安全开发
- 遵循ESLint和Prettier代码规范
- 编写详细的注释和文档
- 使用Git进行版本控制

### 提交规范
- 每次提交前进行代码格式化
- 提交信息清晰描述变更内容
- 重要功能需要编写测试用例
- 定期进行代码审查

### 文档规范
- 及时更新API文档
- 编写用户使用手册
- 记录重要的设计决策
- 维护开发日志 